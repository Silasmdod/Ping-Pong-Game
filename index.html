<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!--
    Autor: Silas Matheus
    Data:13/08/2024
    
    Ideias para colocar
    
    1-um inicializador, "Começar" ou Start
    2-um pause
    3-E incluir sons
    4-Um de musiquinha
    5-também dos toques da bola na superfície lateral
    6- os tóques na raquete,
    7- De quando um ponto é feito
    8- e da mudança do placar
    9- o jogo acaba no terceiro ponto e ao fazer o terceiro ponto,
    perguntar se quer ir de novo
    10- Na pausa, opção de voltar ou reiniciar.
    -->

    <!--Links rel-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <!-- Importante colocar esse último de baixo senão, não vai aparecer o icone
     no navegador-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">


    <!--web font-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo Ping-Pong</title>

    <style>
        * {
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        #lembrete{
            position: absolute;
            top: 870px;
            width: 100%;
            text-align: center;
            font-size: 24px;
            font-family: "Press Start 2P", system-ui;
            color: #cccccc; /* Corrigido a cor para não estar entre aspas */
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.5s ease-in-out; /* Corrigido a sintaxe do tempo de transição */
        }

        canvas{
            display: block;
            background-color: #286047;
        }

    

    </style>
</head>
<body>
    <!--Criando um lembrete de pause-->
    <div id="lembrete">Pressione "Espaço" para pausar</div>

    <canvas></canvas>
    <script>
        //criando a ação do lembrete piscar
        const lembrete = document.getElementById('lembrete');

        //criando a variável do intervalo do lembrete
        let lembreteInterval;

        //variável que armazena o estado de pausa.
        let isPaused = false;

        const canvasEl = document.querySelector("canvas"),
              canvasCtx = canvasEl.getContext("2d"),
              gapX = 10;

        //começando a separar as funções, estilo POO
        //objeto do mouse
        const mouse = { x: 0, y: 0 };

        //Criando Objeto campo
        const field = {
            w: window.innerWidth,
            h: window.innerHeight,
            draw: function() {
                //Desenhando o campo
                canvasCtx.fillStyle = "#286047";
                canvasCtx.fillRect(0, 0, this.w, this.h);
            }
        };

        //Objeto Linha
        const line = {
            w: 15,
            h: field.h,
            draw: function() {
                //Desenhando a linha do meio do campo
                canvasCtx.fillStyle = "#ffffff";
                canvasCtx.fillRect(field.w / 2 - this.w / 2, 0, this.w, this.h);
            }
        };

        //Objeto Raquete esquerda
        const leftPaddle = {
            x: gapX,
            y: 0,
            w: line.w,
            h: 200,
            _move: function() {
                this.y = mouse.y - this.h / 2; //o this.h / 2 é para o mouse ficar no meio da raquete
            },
            draw: function() {
                //desenha a raquete esquerda
                canvasCtx.fillStyle = "#ffffff";
                canvasCtx.fillRect(this.x, this.y, this.w, this.h);
                this._move();
            }
        };

        //Objeto Raquete direita
        const rightPaddle = {
            x: field.w - line.w - gapX,
            y: 0,
            w: line.w,
            h: 200,
            speed: 5, // Corrigido 'Speed' para 'speed'
            _move: function() {
                if (this.y + this.h / 2 < ball.y + ball.r) {
                    this.y += this.speed;
                } else {
                    this.y -= this.speed;
                }
            },
            speedUp: function() {
                this.speed += 2;
            },
            draw: function() {
                //Agora desenhando a raquete direita
                canvasCtx.fillStyle = "#ffffff";
                canvasCtx.fillRect(this.x, this.y, this.w, this.h);
                this._move();
            }
        };

        //Objeto Bola
        const ball = {
            x: field.w / 2,
            y: field.h / 2,
            r: 20,
            speed: 5,
            directionX: 1,
            directionY: 1,
            _calcPosition: function() {
                //verificando se o jogador fez 1 ponto (x > largura do campo)
                if (this.x > field.w - this.r - rightPaddle.w - gapX) {
                    //verifica se a raquete direita está na posição y da bola
                    if (this.y + this.r > rightPaddle.y &&
                        this.y - this.r < rightPaddle.y + rightPaddle.h) {
                        //rebate a bola invertendo o sinal de X
                        this._reverseX();
                    } else {
                        //pontuar o jogador
                        score.increaseHuman();
                        this._pointUp();
                    }
                }

                //verificando se o jogador 2(pc) fez um ponto (x < 0)
                if (this.x < this.r + leftPaddle.w + gapX) {
                    //verifica se a raquete esquerda está na posição y da bola
                    if (this.y + this.r > leftPaddle.y &&
                        this.y - this.r < leftPaddle.y + leftPaddle.h) {
                        //rebate a bola invertendo o sinal de x
                        this._reverseX();
                    } else {
                        score.increaseComputer();
                        this._pointUp();
                    }
                }

                //verifica as laterais superior e inferior do campo
                if ((this.y - this.r < 0 && this.directionY < 0) ||
                    (this.y > field.h - this.r && this.directionY > 0)) {
                    //rebate a bola invertendo o sinal do eixo y
                    this._reverseY();
                }
            },
            _reverseX: function() {
                this.directionX *= -1;
            },
            _reverseY: function() {
                // 1 * -1 = -1
                // -1 * -1 = 1
                this.directionY *= -1;
            },
            _speedUp: function() {
                this.speed += 2;
            },
            _pointUp: function() {
                this._speedUp(); //para aumentar a velocidade a cada ponto feito, aumentando a dificuldade
                rightPaddle.speedUp();

                this.x = field.w / 2;
                this.y = field.h / 2;
            },
            _move: function() { //quando for funções internas, as especificar colocando underline
                this.x += this.directionX * this.speed;
                this.y += this.directionY * this.speed;
            },
            draw: function() {
                canvasCtx.fillStyle = "#ffffff";
                //Agora desenhando a bolinha 
                // Para desenhar a bola não é possível usar fillRect (já que obviamente é para figuras retangulares
                //então usa-se o beginPath, o arc e o fill
                canvasCtx.beginPath();
                // 200(x) o 300(y), 20 de raio e o início do raio sendo 0 , e o fim sendo
                // 2 vezes Math.PI (que seria o pi)
                canvasCtx.arc(this.x, this.y, this.r, 0, 2 * Math.PI, false); //o restante é fixo, a parte do cálculo
                canvasCtx.fill(); //desenha uma forma sólida através de um preenchimento.

                this._calcPosition();
                this._move();
            }
        };

        //Objeto Placar
        const score = {
            human: 0,
            computer: 0,
            increaseHuman: function() {
                this.human++;
            },
            increaseComputer: function() {
                this.computer++;
            },
            draw: function() {
                //Desenhando o placar
                canvasCtx.font = "bold 72px Arial";
                canvasCtx.textAlign = "center"; // centralizando
                canvasCtx.textBaseline = "top"; //deixando no topo
                canvasCtx.fillStyle = '#cccccc';
                canvasCtx.fillText(this.human, field.w / 4, 50);
                canvasCtx.fillText(this.computer, field.w / 4 + field.w / 2, 50);
            }
        };

        function setup() {
            canvasEl.width = field.w;
            canvasEl.height = field.h;
        }

        function draw() { //Aplicando os métodos dos objetos, dentro da função de aplicação de desenhar
            field.draw();
            line.draw();
            leftPaddle.draw();
            rightPaddle.draw();
            score.draw();
            ball.draw();
        }

        //Aqui fazendo o comando para a animação ficar mais suave
        window.animateFrame = (function() {
            return (
                window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                window.oRequestAnimationFrame || // Corrigido 'window.oRequestAnimationFram' para 'window.oRequestAnimationFrame'
                function(callback) {
                    return window.setTimeout(callback, 1000 / 60);
                }
            );
        })();

        //criando a função de piscar do lembrete
        function toggleVisibility(){
            if(!isPaused){
                if(lembrete.style.opacity == 1){
                    lembrete.style.opacity = 0;
                } else {
                    lembrete.style.opacity = 1;
                }
            }
        }

        //criando o start para voltar a piscar
        function startLembreteInterval(){
            lembreteInterval = setInterval(toggleVisibility, 2000); 
            // Corrigido para usar setInterval
        }

        //criando função de pausar o lembrete
        function stopLembreteInterval(){
            clearInterval(lembreteInterval);
        }

        startLembreteInterval();

        function main() {
            if(!isPaused){ //se está diferente de false ou seja true, desenhe
                draw();
            }
            requestAnimationFrame(main);
        }

        //adicionando o evento do teclado para pausar ou continuar
        window.addEventListener('keydown', function(event){
            if (event.code === 'Space'){
                //alternar entre pausar e continuar
                isPaused = !isPaused;
                if(isPaused){
                    stopLembreteInterval();
                } else {
                    startLembreteInterval();
                }
            }
        });

        setup();
        main();

        //Criando o evento que escuta o mouse
        canvasEl.addEventListener("mousemove", function(e) {
            mouse.x = e.pageX;
            mouse.y = e.pageY;
            console.log(mouse);
        });
    </script>
</body>
</html>